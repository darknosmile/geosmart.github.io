<!doctype html>
<html class="theme-next use-motion theme-next-mist">
<head>
  

<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">








  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5">




<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.1">


    <meta name="description" content="追求心智成长，记录技术点滴">



  <meta name="keywords" content="IIS,J2EE,Tomcat,Web服务器,运维,">



  <link rel="alternate" href="/atom.xml" title="Geosmart's Notes" type="application/atom+xml">



  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.1">


<meta name="description" content="&amp;#x5FAE;&amp;#x4FE1;&amp;#x516C;&amp;#x4F17;&amp;#x53F7;&amp;#x6709;80&amp;#x7AEF;&amp;#x53E3;&amp;#x8981;&amp;#x6C42;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;80&amp;#x7AEF;&amp;#x53E3;&amp;#x5DF2;&amp;#x8FD0;&amp;#x884C;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;&amp;#x9879;&amp;#x76EE;&amp;#xFF0C;&amp;#x5">
<meta property="og:type" content="article">
<meta property="og:title" content="IIS与Tomcat共享80端口">
<meta property="og:url" content="http://geosmart.github.io/2015/08/03/IIS与Tomcat共享80端口/index.html">
<meta property="og:site_name" content="Geosmart's Notes">
<meta property="og:description" content="&amp;#x5FAE;&amp;#x4FE1;&amp;#x516C;&amp;#x4F17;&amp;#x53F7;&amp;#x6709;80&amp;#x7AEF;&amp;#x53E3;&amp;#x8981;&amp;#x6C42;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;80&amp;#x7AEF;&amp;#x53E3;&amp;#x5DF2;&amp;#x8FD0;&amp;#x884C;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;&amp;#x9879;&amp;#x76EE;&amp;#xFF0C;&amp;#x5">
<meta property="og:updated_time" content="2015-09-07T13:27:57.256Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="IIS与Tomcat共享80端口">
<meta name="twitter:description" content="&amp;#x5FAE;&amp;#x4FE1;&amp;#x516C;&amp;#x4F17;&amp;#x53F7;&amp;#x6709;80&amp;#x7AEF;&amp;#x53E3;&amp;#x8981;&amp;#x6C42;&amp;#xFF0C;&amp;#x4F46;&amp;#x662F;80&amp;#x7AEF;&amp;#x53E3;&amp;#x5DF2;&amp;#x8FD0;&amp;#x884C;&amp;#x4E86;&amp;#x4E00;&amp;#x4E2A;&amp;#x9879;&amp;#x76EE;&amp;#xFF0C;&amp;#x5">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post'
  };
</script>

  <title> IIS与Tomcat共享80端口 | Geosmart's Notes </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  

  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?//hm.baidu.com/hm.js?221699150bf25edfe6338d0a9f205159";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand" rel="start">
      <span class="logo">
        <i class="icon-next-logo"></i>
      </span>
      <span class="site-title">Geosmart's Notes</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu menu-left">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon icon-next-home"></i> <br>
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            <i class="menu-item-icon icon-next-archives"></i> <br>
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            <i class="menu-item-icon icon-next-tags"></i> <br>
            标签
          </a>
        </li>
      

      
      
    </ul>
  

  
    <div class="site-search">
      
  
  <form class="site-search-form">
    <input type="text" id="st-search-input" class="st-search-input st-default-search-input">
  </form>


<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'sx6vPCUTjNbABKwx8Vig','2.0.0');
</script>



    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 

  <div id="posts" class="posts-expand">
    

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              IIS与Tomcat共享80端口
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2015-08-03T16:27:21+08:00" content="3   August   2015">
            3   August   2015
          </time>
        </span>

        
          <span class="post-category">
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/运维/" itemprop="url" rel="index">
                  <span itemprop="name">运维</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2015/08/03/IIS与Tomcat共享80端口/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2015/08/03/IIS与Tomcat共享80端口/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        <span itemprop="articleBody"><p>&#x5FAE;&#x4FE1;&#x516C;&#x4F17;&#x53F7;&#x6709;80&#x7AEF;&#x53E3;&#x8981;&#x6C42;&#xFF0C;&#x4F46;&#x662F;80&#x7AEF;&#x53E3;&#x5DF2;&#x8FD0;&#x884C;&#x4E86;&#x4E00;&#x4E2A;&#x9879;&#x76EE;&#xFF0C;&#x5982;&#x4F55;&#x5C06;&#x540E;&#x7AEF;J2EE&#x5B9E;&#x73B0;&#x7684;&#x670D;&#x52A1;&#x96C6;&#x6210;&#x5230;80&#x7AEF;&#x53E3;&#xFF0C;&#x5373;Tomcat&#x96C6;&#x6210;&#x8FDB;IIS&#x3002;
&#x8C03;&#x7814;&#x4E86;&#x4E09;&#x79CD;&#x65B9;&#x6848;&#xFF0C;Apache Tomcat Connector&#xFF08;isapi_redirect&#x5B9E;&#x73B0;&#xFF09;&#x3001;ARR&#xFF08;IIS&#x4E2D;&#x7684;&#x53CD;&#x5411;&#x4EE3;&#x7406;&#xFF09;&#x548C; IIS2Tomcat(BonCode AJP&#x5B9E;&#x73B0;)&#xFF0C;&#x6309;&#x7167;&#x6700;&#x8F7B;&#x91CF;&#x6700;&#x7B80;&#x6D01;&#x7684;&#x90E8;&#x7F72;&#x8981;&#x6C42;&#xFF0C;&#x6700;&#x7EC8;&#x91C7;&#x7528;AJP&#x5B9E;&#x73B0;&#x3002;</p>
<h1 id="isapi_redirect">isapi_redirect</h1>
<p><a href="http://tomcat.apache.org/connectors-doc/webserver_howto/iis.html">&#x5B98;&#x65B9;&#x53C2;&#x8003;</a><br>
&#x5B9E;&#x73B0;&#x601D;&#x8DEF;&#xFF1A;</p>
<ol>
<li>The IIS-Tomcat redirector is an IIS plugin (filter + extension), IIS load the redirector plugin and calls its filter function for each in-coming request.</li>
<li>The filter then tests the request URL against a list of URI-paths held inside uriworkermap.properties, If the current request matches one of the entries in the list of URI-paths, the filter transfers the request to the extension.</li>
<li>The extension collects the request parameters and forwards them to the appropriate worker using the defined protocol like ajp13.</li>
<li>The extension collects the response from the worker and returns it to the browser<br>
&#x914D;&#x7F6E;&#x6CE8;&#x518C;&#x8868;&#xFF0C;DLL&#x7B49;&#x6B65;&#x9AA4;&#x7E41;&#x7410;&#xFF0C;&#x6613;&#x51FA;&#x9519;&#xFF0C;&#x5982;&#x5B98;&#x65B9;&#x6240;&#x8BF4;&#x4F60;&#x5F88;&#x96BE;&#x4E00;&#x6B21;&#x6027;&#x914D;&#x7F6E;&#x6210;&#x529F;-_-</li>
</ol>
<h1 id="arr">ARR</h1>
<p>ARR&#xFF1A;Application Request Routing&#xFF0C;&#x7C7B;&#x4F3C;Nginx&#x7684;&#x53CD;&#x5411;&#x4EE3;&#x7406;<br>
<a href="http://www.iisadmin.co.uk/?p=326">&#x914D;&#x7F6E;&#x6559;&#x7A0B;</a><br>
ARR is a good starting point if you want to connect Apache Tomcat to IIS 7, however, there are some issues especially under load that make this less than ideal solution.</p>
<ol>
<li>There are still differences in the way headers are handled between ARR and Tomcat and not all are transferred.</li>
<li>ARR will be heavier on the network as it requires that http data is transferred in full byte length without being able to take advantage of binary compression and byte encoding the AJP protocol offers.</li>
<li>Under load ARR will not be aware of Tomcat thread handling resulting in unnecessarily dropped connections.</li>
<li>Secure (https) connections cannot be easily handled if tomcat needs to be aware of certificates used.</li>
</ol>
<h1 id="ajp">AJP</h1>
<p>AJP&#xFF1A;Apache JServ Protocol version<br>
<a href="https://github.com/Bilal-S/iis2tomcat">&#x9879;&#x76EE;&#x5730;&#x5740;</a><br>
<a href="http://tomcatiis.riaforge.org">&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#xFF08;&#x9700;&#x7FFB;&#x5899;&#xFF09;</a><br>
<a href="http://blog.csdn.net/zhang_hui_cs/article/details/9399373#reply">&#x53C2;&#x8003;&#x535A;&#x5BA2;</a><br>
<a href="http://v.youku.com/v_show/id_XNTg1MTgyODgw.html">&#x8BE6;&#x7EC6;&#x914D;&#x7F6E;&#x89C6;&#x9891;&#x6559;&#x7A0B;</a></p>
<h2 id="&#x9ED8;&#x8BA4;&#x7F51;&#x7AD9;&#x4E8C;&#x7EA7;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x914D;&#x7F6E;&#x8981;&#x70B9;">&#x9ED8;&#x8BA4;&#x7F51;&#x7AD9;&#x4E8C;&#x7EA7;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x914D;&#x7F6E;&#x8981;&#x70B9;</h2>
<ol>
<li>&#x6267;&#x884C;Connector_Setup.exe&#x5B89;&#x88C5;</li>
<li>&#x5728;IIS&#x9ED8;&#x8BA4;&#x7F51;&#x7AD9;&#x4E0B;&#x65B0;&#x589E;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;examples,&#x7269;&#x7406;&#x8DEF;&#x5F84;&#x6307;&#x5411;tomcat/webapps/examples</li>
<li>&#x5728;examples&#x6839;&#x76EE;&#x5F55;&#x65B0;&#x589E;&#x914D;&#x7F6E;BIN&#x76EE;&#x5F55;&#xFF08;&#x5305;&#x542B;BonCodeAJP13.dll&#x3001;BonCodeIIS.dll&#x548C;iisRemoveHandlers.txt&#xFF09;&#x548C;web.config
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">system.webServer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">handlers</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">add</span> <span class="attribute">name</span>=<span class="value">&quot;BonCodeForAll&quot;</span> <span class="attribute">path</span>=<span class="value">&quot;*&quot;</span> <span class="attribute">verb</span>=<span class="value">&quot;*&quot;</span> <span class="attribute">type</span>=<span class="value">&quot;BonCodeIIS.BonCodeCallHandler&quot;</span> <span class="attribute">resourceType</span>=<span class="value">&quot;Unspecified&quot;</span> <span class="attribute">preCondition</span>=<span class="value">&quot;integratedMode&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">add</span> <span class="attribute">name</span>=<span class="value">&quot;BonCode-Tomcat-JSP-Handler&quot;</span> <span class="attribute">path</span>=<span class="value">&quot;*.jsp&quot;</span> <span class="attribute">verb</span>=<span class="value">&quot;*&quot;</span> <span class="attribute">type</span>=<span class="value">&quot;BonCodeIIS.BonCodeCallHandler&quot;</span> <span class="attribute">preCondition</span>=<span class="value">&quot;integratedMode&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">add</span> <span class="attribute">name</span>=<span class="value">&quot;BonCode-Tomcat-CFC-Handler&quot;</span> <span class="attribute">path</span>=<span class="value">&quot;*.cfc&quot;</span> <span class="attribute">verb</span>=<span class="value">&quot;*&quot;</span> <span class="attribute">type</span>=<span class="value">&quot;BonCodeIIS.BonCodeCallHandler&quot;</span> <span class="attribute">preCondition</span>=<span class="value">&quot;integratedMode&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">add</span> <span class="attribute">name</span>=<span class="value">&quot;BonCode-Tomcat-CFM-Handler&quot;</span> <span class="attribute">path</span>=<span class="value">&quot;*.cfm&quot;</span> <span class="attribute">verb</span>=<span class="value">&quot;*&quot;</span> <span class="attribute">type</span>=<span class="value">&quot;BonCodeIIS.BonCodeCallHandler&quot;</span> <span class="attribute">preCondition</span>=<span class="value">&quot;integratedMode&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">handlers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">defaultDocument</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="title">files</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">add</span> <span class="attribute">value</span>=<span class="value">&quot;index.jsp&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="title">add</span> <span class="attribute">value</span>=<span class="value">&quot;index.cfm&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="title">files</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">defaultDocument</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">system.webServer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol></span>
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/IIS/" rel="tag">#IIS</a>
          
            <a href="/tags/J2EE/" rel="tag">#J2EE</a>
          
            <a href="/tags/Tomcat/" rel="tag">#Tomcat</a>
          
            <a href="/tags/Web服务器/" rel="tag">#Web服务器</a>
          
            <a href="/tags/运维/" rel="tag">#运维</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/08/05/Python安装升级教程/" rel="prev">Python安装升级教程</a>
            
          </div>

          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/07/28/backbone-marionette学习要点/" rel="next">backbone.marionette学习要点</a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

 </div>

        

        
          <div class="comments" id="comments">
            
              <div class="ds-thread" data-thread-key="2015/08/03/IIS与Tomcat共享80端口/" data-title="IIS与Tomcat共享80端口" data-url="http://geosmart.github.io/2015/08/03/IIS与Tomcat共享80端口/">
              </div>
            
          </div>
        
      </div>

      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="https://avatars1.githubusercontent.com/u/3156608?v=3&s=460" alt="geosmart" itemprop="image">
          <p class="site-author-name" itemprop="name">geosmart</p>
        </div>
        <p class="site-description motion-element" itemprop="description">追求心智成长，记录技术点滴</p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">26</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">6</span>
              <span class="site-state-item-name">分类</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">34</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="menu-item-icon icon-next-feed"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator"></div>
          <div class="post-toc">
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#isapi_redirect"><span class="nav-number">1.</span> <span class="nav-text">isapi_redirect</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#arr"><span class="nav-number">2.</span> <span class="nav-text">ARR</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ajp"><span class="nav-number">3.</span> <span class="nav-text">AJP</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#默认网站二级应用程序配置要点"><span class="nav-number">3.1.</span> <span class="nav-text">默认网站二级应用程序配置要点</span></a></li></ol></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator"></div>
        </section>
      

    </div>
  </aside>


    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright">
  
  &copy; &nbsp; 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-next-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">geosmart</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"geosmart"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     
     
  	  <script type="text/javascript">
  		var duoshuo_user_ID = geosmart
      var duoshuo_admin_nickname="geosmart"
  	  </script>
     
  	<script src="/js/ua-parser.min.js"></script>
  	<script src="/js/hook-duoshuo.js"></script>
  

    
  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.1"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.1"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.1" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.1"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  
<script type="text/javascript" src="/js/bootstrap.scrollspy.js?v=0.4.5.1" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 0.4 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    var $tocContent = $('.post-toc-content');
    if (isDesktop() && CONFIG.sidebar === 'post') {
      if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
        displaySidebar();
      }
    }
  });
</script>



  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }
    });
  </script>

  

  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>
</body>
</html>