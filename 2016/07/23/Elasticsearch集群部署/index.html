<!doctype html>
<html class="theme-next use-motion theme-next-mist">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />








  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>




<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.1"/>




  <meta name="keywords" content="Elasticsearch," />





  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.1" />


<meta name="description" content="Elasticsearch V2.3.4 集群部署记录：3个Node，6个Shard，2个Replica，能保证一台服务器宕机服务还能正常运行，且后期容易扩展到6个Node；">
<meta name="keywords" content="Elasticsearch">
<meta property="og:type" content="article">
<meta property="og:title" content="Elasticsearch集群部署">
<meta property="og:url" content="http://geosmart.github.io/2016/07/23/Elasticsearch集群部署/index.html">
<meta property="og:site_name" content="Geosmart&#39;s Notes">
<meta property="og:description" content="Elasticsearch V2.3.4 集群部署记录：3个Node，6个Shard，2个Replica，能保证一台服务器宕机服务还能正常运行，且后期容易扩展到6个Node；">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://geosmart.github.io/2016/07/23/Elasticsearch集群部署/es_cluster_shard1.png">
<meta property="og:image" content="http://geosmart.github.io/2016/07/23/Elasticsearch集群部署/es_cluster_shard2.png">
<meta property="og:image" content="http://geosmart.github.io/2016/07/23/Elasticsearch集群部署/es_cluster_shard3.png">
<meta property="og:image" content="http://geosmart.github.io/2016/07/23/Elasticsearch集群部署/es_cluster_shard4.png">
<meta property="og:updated_time" content="2016-08-06T09:21:28.181Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Elasticsearch集群部署">
<meta name="twitter:description" content="Elasticsearch V2.3.4 集群部署记录：3个Node，6个Shard，2个Replica，能保证一台服务器宕机服务还能正常运行，且后期容易扩展到6个Node；">
<meta name="twitter:image" content="http://geosmart.github.io/2016/07/23/Elasticsearch集群部署/es_cluster_shard1.png">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post'
  };
</script>

  <title> Elasticsearch集群部署 | Geosmart's Notes </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  

  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?221699150bf25edfe6338d0a9f205159";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>



  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand" rel="start">
      <span class="logo">
        <i class="icon-next-logo"></i>
      </span>
      <span class="site-title">Geosmart's Notes</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon icon-next-home"></i> <br />
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            <i class="menu-item-icon icon-next-archives"></i> <br />
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            <i class="menu-item-icon icon-next-tags"></i> <br />
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            <i class="menu-item-icon icon-next-categories"></i> <br />
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            <i class="menu-item-icon icon-next-about"></i> <br />
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            <i class="menu-item-icon icon-next-commonweal"></i> <br />
            公益404
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 

  <div id="posts" class="posts-expand">
    

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              Elasticsearch集群部署
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2016-07-23T07:54:33+08:00" content="23   July   2016">
            23   July   2016
          </time>
        </span>

        
          <span class="post-category" >
            &nbsp; | &nbsp; 分类于
            
              <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                <a href="/categories/后端技术/" itemprop="url" rel="index">
                  <span itemprop="name">后端技术</span>
                </a>
              </span>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/2016/07/23/Elasticsearch集群部署/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/23/Elasticsearch集群部署/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        <span itemprop="articleBody"><p>Elasticsearch V2.3.4 集群部署记录：3个Node，6个Shard，2个Replica，能保证一台服务器宕机服务还能正常运行，且后期容易扩展到6个Node；</p>
<hr>
<a id="more"></a> 
<h1 id="安装Java"><a href="#安装Java" class="headerlink" title="安装Java"></a>安装Java</h1><p>sudo yum install java-1.8.0-openjdk.x86_64<br>Centos7自带openJdk8</p>
<h1 id="swap配置"><a href="#swap配置" class="headerlink" title="swap配置"></a>swap配置</h1><p><a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/heap-sizing.html#_swapping_is_the_death_of_performance">swapping_is_the_death_of_performance</a>,<br>ElasticSearch建议将 /proc/sys/vm/swappiness 设置为 0。默认设置为30。<br>查看当前swap分区设置<code>cat /proc/sys/vm/swappiness</code><br>临时修改值：<code>sudo sysctl vm.swappiness=0</code> / <code>sudo swapoff -a</code><br>永久修改值：<code>vim /etc/sysctl.conf</code>，在最后加一行<code>vm.swappiness = 0</code></p>
<h1 id="修改hostname"><a href="#修改hostname" class="headerlink" title="修改hostname"></a>修改hostname</h1><p>设置hostname为v3es1，并查看修改结果<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash">es1</span></div><div class="line">hostnamectl set-hostname es1</div><div class="line">hostnamectl set-hostname es1 --static</div><div class="line">hostnamectl status</div></pre></td></tr></table></figure></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash">es2</span></div><div class="line">hostnamectl set-hostname es2</div><div class="line">hostnamectl set-hostname es2 --static</div><div class="line">hostnamectl status</div></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash">es3</span></div><div class="line">hostnamectl set-hostname es3</div><div class="line">hostnamectl set-hostname es3 --static</div><div class="line">hostnamectl status</div></pre></td></tr></table></figure>
<p><code>vim  /etc/hosts</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> es节点配置</span></div><div class="line">193.168.201.213 es1.es.com es1</div><div class="line">193.168.201.85  es2.es.com es2</div><div class="line">193.168.201.117 es3.es.com es3</div></pre></td></tr></table></figure></p>
<h2 id="局域网hosts配置"><a href="#局域网hosts配置" class="headerlink" title="局域网hosts配置"></a>局域网hosts配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash"> 局域网hosts配置es</span></div><div class="line">193.168.201.223 es1.es.com</div><div class="line">193.168.201.223 www.es1.es.com</div><div class="line">193.168.201.252  es2.es.com</div><div class="line">193.168.201.252  www.es2.es.com</div><div class="line">193.168.201.117  es3.es.com</div><div class="line">193.168.201.117  www.es3.es.com</div></pre></td></tr></table></figure>
<h1 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#</span><span class="bash">停止firewall</span></div><div class="line">systemctl stop firewalld.service</div><div class="line"><span class="meta">#</span><span class="bash">禁止firewall开机启动 </span></div><div class="line">systemctl disable firewalld.service</div></pre></td></tr></table></figure>
<h1 id="新增用户"><a href="#新增用户" class="headerlink" title="新增用户"></a>新增用户</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">mkdir -p /data/elasticsearch/&#123;data,work,plugins,scripts&#125; </div><div class="line">useradd elasticsearch -s /bin/bash </div><div class="line"><span class="meta">#</span><span class="bash"> 1</span></div><div class="line">passwd elasticsearch</div><div class="line">vim /etc/sudoers	</div><div class="line"><span class="meta">#</span><span class="bash"> 新增</span></div><div class="line">elasticsearch    ALL=(ALL)       ALL</div><div class="line"><span class="meta">#</span><span class="bash"> 授权</span></div><div class="line">mkdir /var/log/elasticsearch</div><div class="line">chown -R elasticsearch:elasticsearch /var/log/elasticsearch /data/elasticsearch</div></pre></td></tr></table></figure>
<h1 id="安装elasticsearch"><a href="#安装elasticsearch" class="headerlink" title="安装elasticsearch"></a>安装elasticsearch</h1><p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-configure-elasticsearch-on-centos-7">how-to-install-and-configure-elasticsearch-on-centos-7</a></p>
<h2 id="下载rpm包"><a href="#下载rpm包" class="headerlink" title="下载rpm包"></a>下载rpm包</h2><p>cd /mnt<br><code>wget https://download.elastic.co/elasticsearch/release/org/elasticsearch/distribution/rpm/elasticsearch/2.3.4/elasticsearch-2.3.4.rpm</code></p>
<h2 id="yum本地安装"><a href="#yum本地安装" class="headerlink" title="yum本地安装"></a>yum本地安装</h2><p><code>cd /mnt &amp;&amp; sudo yum localinstall elasticsearch-2.3.4.rpm</code> </p>
<h2 id="设置自启动"><a href="#设置自启动" class="headerlink" title="设置自启动"></a>设置自启动</h2><p><code>sudo systemctl daemon-reload</code><br><code>sudo systemctl enable elasticsearch.service</code></p>
<h2 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h2><p><code>vim /etc/elasticsearch/elasticsearch.yml</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="string">cluster.name:</span> <span class="string">cloudx_web</span></div><div class="line"><span class="string">node.name:</span> <span class="string">$&#123;HOSTNAME&#125;</span></div><div class="line"><span class="string">node.master:</span> <span class="literal">true</span></div><div class="line"><span class="string">node.data:</span> <span class="literal">true</span></div><div class="line"><span class="string">index.number_of_shards:</span> <span class="number">6</span></div><div class="line"><span class="string">index.number_of_replicas:</span> <span class="number">2</span></div><div class="line"><span class="string">network.host:</span> <span class="string">$&#123;HOSTNAME&#125;</span></div><div class="line"><span class="string">index.max_result_window:</span> <span class="number">10000000</span></div><div class="line"><span class="string">discovery.zen.minimum_master_nodes:</span> <span class="number">2</span></div><div class="line"><span class="string">discovery.zen.ping.unicast.hosts:</span> <span class="string">[es1,es2,es3]</span></div><div class="line"><span class="string">discovery.zen.ping.multicast.enabled:</span> <span class="literal">true</span></div><div class="line"><span class="string">path.data:</span> <span class="string">/data/elasticsearch</span> </div><div class="line"><span class="string">http.cors.allow-origin:</span> <span class="string">"*"</span></div><div class="line"><span class="string">http.cors.enabled:</span> <span class="literal">true</span></div></pre></td></tr></table></figure>
<p>复制到集群：<code>scp  /etc/elasticsearch/elasticsearch.yml root@es1:/etc/elasticsearch/</code></p>
<blockquote>
<p>理想状态下，3个Node，6个Shard，2个Replica，能保证一台服务器宕机服务还能正常运行，且后期容易扩展到6个Node；<br>但如果存储成本高，可改为1个Replica<br>另配置<code>discovery.zen.minimum_master_nodes=2</code>可保证不会出现脑裂问题；  </p>
</blockquote>
<p>3个节点正常运行<br><img src="es_cluster_shard1.png" alt="3个节点正常运行"><br>节点3挂了<br><img src="es_cluster_shard2.png" alt="节点3挂了"><br>replica自动复制迁移<br><img src="es_cluster_shard3.png" alt="replica自动复制迁移"><br>节点3恢复正常<br><img src="es_cluster_shard4.png" alt="节点3恢复正常"></p>
<h2 id="配置elasticsearch-heap大小"><a href="#配置elasticsearch-heap大小" class="headerlink" title="配置elasticsearch heap大小"></a>配置elasticsearch heap大小</h2><p><code>vim /etc/sysconfig/elasticsearch</code><br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="string">ES_HEAP_SIZE=3G</span></div><div class="line"><span class="string">MAX_OPEN_FILES=65535</span></div></pre></td></tr></table></figure></p>
<h2 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h2><p>su elasticsearch<br><code>sudo systemctl start elasticsearch.service</code> </p>
<h2 id="查看运行状态"><a href="#查看运行状态" class="headerlink" title="查看运行状态"></a>查看运行状态</h2><p><code>service elasticsearch status</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="string">●</span> <span class="string">elasticsearch.service</span> <span class="bullet">-</span> <span class="string">Elasticsearch</span></div><div class="line"><span class="attr">   Loaded:</span> <span class="string">loaded</span> <span class="string">(/usr/lib/systemd/system/elasticsearch.service;</span> <span class="string">enabled;</span> <span class="string">vendor</span> <span class="attr">preset:</span> <span class="string">disabled)</span></div><div class="line"><span class="attr">   Active:</span> <span class="string">active</span> <span class="string">(running)</span> <span class="string">since</span> <span class="string">日</span> <span class="number">2016</span><span class="bullet">-07</span><span class="bullet">-24</span> <span class="number">19</span><span class="string">:56:07</span> <span class="string">CST;</span> <span class="number">8</span><span class="string">min</span> <span class="string">ago</span></div><div class="line"><span class="attr">     Docs:</span> <span class="attr">http://www.elastic.co</span></div><div class="line"><span class="attr">  Process:</span> <span class="number">9370</span> <span class="string">ExecStartPre=/usr/share/elasticsearch/bin/elasticsearch-systemd-pre-exec</span> <span class="string">(code=exited,</span> <span class="string">status=0/SUCCESS)</span></div><div class="line"> <span class="string">Main</span> <span class="attr">PID:</span> <span class="number">9374</span> <span class="string">(java)</span></div><div class="line"><span class="attr">   CGroup:</span> <span class="string">/system.slice/elasticsearch.service</span></div><div class="line">           <span class="string">└─9374</span> <span class="string">/bin/java</span> <span class="bullet">-Xms256m</span> <span class="bullet">-Xmx1g</span> <span class="bullet">-Djava.awt.headless=true</span> <span class="attr">-XX:+UseParNewGC</span> <span class="attr">-XX:+UseC...</span></div></pre></td></tr></table></figure>
<h2 id="测试是否成功"><a href="#测试是否成功" class="headerlink" title="测试是否成功"></a>测试是否成功</h2><p>curl -X GET ‘<a href="http://localhost:9200">http://localhost:9200</a>‘<br>curl -X GET ‘<a href="http://193.168.201.250:9200">http://193.168.201.250:9200</a>‘<br>curl -X GET ‘<a href="http://193.168.201.252:9200">http://193.168.201.252:9200</a>‘<br>curl -X GET ‘<a href="http://193.168.201.117:9200">http://193.168.201.117:9200</a>‘</p>
<h2 id="插入测试"><a href="#插入测试" class="headerlink" title="插入测试"></a>插入测试</h2><p>curl -X POST ‘<a href="http://es1:9200/tutorial/helloworld/1">http://es1:9200/tutorial/helloworld/1</a>‘ -d ‘{ “message”: “Hello World!” }’<br>curl -X GET ‘<a href="http://es1:9200/tutorial/helloworld/1?pretty">http://es1:9200/tutorial/helloworld/1?pretty</a>‘</p>
<h2 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h2><p><code>tail -f  200 /var/log/elasticsearch/cloudx_web.log</code></p>
<h1 id="安装信息"><a href="#安装信息" class="headerlink" title="安装信息"></a>安装信息</h1><ul>
<li>安装目录：<code>/usr/share/elasticsearch/</code></li>
<li>配置目录：<code>/etc/elasticsearch</code></li>
<li>启动初始化脚本：<code>/etc/init.d/elasticsearch</code> </li>
<li>日志目录：<code>/var/log/elasticsearch</code></li>
<li>配置参数(<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/setup-service.html">https://www.elastic.co/guide/en/elasticsearch/reference/current/setup-service.html</a>)</li>
</ul>
<h1 id="删除elasticsearch"><a href="#删除elasticsearch" class="headerlink" title="删除elasticsearch"></a>删除elasticsearch</h1><p><code>yum remove  elasticsearch</code><br><code>find / -name &quot;elasticsearch&quot; -exec  rm -rf {} \;</code></p>
<h1 id="ElasticSearch插件"><a href="#ElasticSearch插件" class="headerlink" title="ElasticSearch插件"></a>ElasticSearch插件</h1><h2 id="Elastic-HQ"><a href="#Elastic-HQ" class="headerlink" title="Elastic-HQ"></a>Elastic-HQ</h2><blockquote>
<p>Monitoring, Management, and Querying Web Interface for ElasticSearch instances and clusters.<br>Benefits:</p>
<ul>
<li>Active real-time monitoring of ElasticSearch clusters and nodes.</li>
<li>Manage Indices, Mappings, Shards, Aliases, and Nodes.</li>
<li>Query UI for searching one or multiple Indices.</li>
<li>REST UI, eliminates the need for cURL and cumbersome JSON formats.</li>
<li>No software to install/download. 100% web browser-based.</li>
<li>Optimized to work on mobile phones, tablets, and other small screen devices.</li>
<li>Easy to use and attractive user interface.</li>
<li>Free (as in Beer)</li>
</ul>
</blockquote>
<ul>
<li>安装：<code>cd /usr/share/elasticsearch/bin &amp;&amp; ./plugin install royrusso/elasticsearch-HQ</code>  </li>
<li>地址：<a href="http://es1.es.com9200/_plugin/hq/">http://es1.es.com9200/_plugin/hq/</a> </li>
</ul>
<h2 id="ElasticSearch-Kopf"><a href="#ElasticSearch-Kopf" class="headerlink" title="ElasticSearch-Kopf"></a>ElasticSearch-Kopf</h2><blockquote>
<p>Kopf是一个ElasticSearch的管理工具，它也提供了对ES集群操作的API。</p>
</blockquote>
<ul>
<li>安装：<code>cd /usr/share/elasticsearch/bin &amp;&amp; ./plugin install lmenezes/elasticsearch-kopf</code> </li>
<li>地址：<a href="http://es1.es.com:9200/_plugin/kopf/">http://es1.es.com:9200/_plugin/kopf/</a></li>
</ul>
<h2 id="Elasticsearch-head"><a href="#Elasticsearch-head" class="headerlink" title="Elasticsearch-head"></a>Elasticsearch-head</h2><blockquote>
<p>A web front end for an Elasticsearch cluster，查看集群状态</p>
</blockquote>
<ul>
<li>安装：<code>cd /usr/share/elasticsearch/bin &amp;&amp; ./plugin install mobz/elasticsearch-head</code>  </li>
</ul>
<h2 id="ElasticSearch-Paramedic"><a href="#ElasticSearch-Paramedic" class="headerlink" title="ElasticSearch-Paramedic"></a>ElasticSearch-Paramedic</h2><blockquote>
<p>Paramedic is a simple yet sexy tool to monitor and inspect ElasticSearch clusters.<br>It displays real-time statistics and information about your nodes and indices, as well as shard allocation within the cluster.<br>The application is written in JavaScript, using the Ember.js framework for sanity and the Cubism.js library for visuals. While the project is useful, the codebase, with most logic in controllers, lacking proper component separation and test suite, can’t be considered mature enough, yet.</p>
</blockquote>
<ul>
<li>安装：cd /usr/share/elasticsearch/bin &amp;&amp; ./plugin install karmi/elasticsearch-paramedic/</li>
<li>地址：<a href="http://es1.es.com:9200/_plugin/paramedic">http://es1.es.com:9200/_plugin/paramedic</a></li>
</ul>
<h2 id="ElasticSearch-Whatson"><a href="#ElasticSearch-Whatson" class="headerlink" title="ElasticSearch-Whatson"></a>ElasticSearch-Whatson</h2><blockquote>
<p>Whatson is an elasticsearch plugin to visualize the state of a cluster. It’s inpired by other excellent plugins:<br>xyu/elasticsearch-whatson</p>
</blockquote>
<ul>
<li>安装：<code>cd /usr/share/elasticsearch/bin &amp;&amp; ./plugin install xyu/elasticsearch-whatson</code>  </li>
<li>地址：<a href="http://es1.es.com:9200/_plugin/whatson">http://es1.es.com:9200/_plugin/whatson</a></li>
</ul>
<h1 id="安装问题"><a href="#安装问题" class="headerlink" title="安装问题"></a>安装问题</h1><h2 id="服务启动问题-Failed-to-created-node-environment"><a href="#服务启动问题-Failed-to-created-node-environment" class="headerlink" title="服务启动问题-Failed to created node environment"></a>服务启动问题-Failed to created node environment</h2><p>启动权限问题，必须以elasticsearch用户启动服务，不能以root启动</p>
<h2 id="配置问题-discovery-zen-ping-unicast-hosts"><a href="#配置问题-discovery-zen-ping-unicast-hosts" class="headerlink" title="配置问题-discovery.zen.ping.unicast.hosts"></a>配置问题-discovery.zen.ping.unicast.hosts</h2><p>Likely root cause: java.net.UnknownHostException: v3es1: unknown error<br>hostname -f查看fqdn</p>
<h2 id="ElasticHQ安装问题"><a href="#ElasticHQ安装问题" class="headerlink" title="ElasticHQ安装问题"></a>ElasticHQ安装问题</h2><p>关闭防火墙，设置好fqdn，关闭VPN</p>
<h2 id="discovery-zen-ping-unicast-hosts中的hostname-ping不通"><a href="#discovery-zen-ping-unicast-hosts中的hostname-ping不通" class="headerlink" title="discovery.zen.ping.unicast.hosts中的hostname ping不通"></a>discovery.zen.ping.unicast.hosts中的hostname ping不通</h2><p>日志</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">discovery.zen.ping.unicast] [es1] failed to send ping to [&#123;#zen_unicast_3#&#125;&#123;193.168.201.117&#125;&#123;es3/193.168.201.117:9300&#125;]</div><div class="line">SendRequestTransportException[internal:discovery/zen/unicast]]; </div><div class="line">nested: NodeNotConnectedException[[][es3/<span class="number">193.168</span>.201.117:<span class="number">9300</span>] Node not connected];</div><div class="line">at org.elasticsearch.transport.TransportService.sendRequest(TransportService.java:<span class="number">340</span>)</div><div class="line">[action.admin.cluster.health] [es1] no known master node, scheduling a retry</div></pre></td></tr></table></figure>
<p>解决：hostname忘记设置了，(╯□╰)</p>
</span>
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Elasticsearch/" rel="tag">#Elasticsearch</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/07/25/Elasticsearch批量插入测试/" rel="prev">Elasticsearch批量插入测试</a>
            
          </div>

          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/07/22/Elasticsearch学习笔记/" rel="next">Elasticsearch学习笔记</a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

 </div>

        

        
          <div class="comments" id="comments">
            
              <div class="ds-thread" data-thread-key="2016/07/23/Elasticsearch集群部署/"
                   data-title="Elasticsearch集群部署" data-url="http://geosmart.github.io/2016/07/23/Elasticsearch集群部署/">
              </div>
            
          </div>
        
      </div>

      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="https://avatars1.githubusercontent.com/u/3156608?v=3&s=128" alt="geosmart" itemprop="image"/>
          <p class="site-author-name" itemprop="name">geosmart</p>
        </div>
        <p class="site-description motion-element" itemprop="description"></p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">88</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            <a href="/categories">
              <span class="site-state-item-count">16</span>
              <span class="site-state-item-name">分类</span>
              </a>
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">69</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator"></div>
          <div class="post-toc">
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#安装Java"><span class="nav-number">1.</span> <span class="nav-text">安装Java</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#swap配置"><span class="nav-number">2.</span> <span class="nav-text">swap配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#修改hostname"><span class="nav-number">3.</span> <span class="nav-text">修改hostname</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#局域网hosts配置"><span class="nav-number">3.1.</span> <span class="nav-text">局域网hosts配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#关闭防火墙"><span class="nav-number">4.</span> <span class="nav-text">关闭防火墙</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#新增用户"><span class="nav-number">5.</span> <span class="nav-text">新增用户</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安装elasticsearch"><span class="nav-number">6.</span> <span class="nav-text">安装elasticsearch</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#下载rpm包"><span class="nav-number">6.1.</span> <span class="nav-text">下载rpm包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#yum本地安装"><span class="nav-number">6.2.</span> <span class="nav-text">yum本地安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#设置自启动"><span class="nav-number">6.3.</span> <span class="nav-text">设置自启动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#修改配置文件"><span class="nav-number">6.4.</span> <span class="nav-text">修改配置文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置elasticsearch-heap大小"><span class="nav-number">6.5.</span> <span class="nav-text">配置elasticsearch heap大小</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#启动服务"><span class="nav-number">6.6.</span> <span class="nav-text">启动服务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看运行状态"><span class="nav-number">6.7.</span> <span class="nav-text">查看运行状态</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#测试是否成功"><span class="nav-number">6.8.</span> <span class="nav-text">测试是否成功</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#插入测试"><span class="nav-number">6.9.</span> <span class="nav-text">插入测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#查看日志"><span class="nav-number">6.10.</span> <span class="nav-text">查看日志</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安装信息"><span class="nav-number">7.</span> <span class="nav-text">安装信息</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#删除elasticsearch"><span class="nav-number">8.</span> <span class="nav-text">删除elasticsearch</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ElasticSearch插件"><span class="nav-number">9.</span> <span class="nav-text">ElasticSearch插件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Elastic-HQ"><span class="nav-number">9.1.</span> <span class="nav-text">Elastic-HQ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ElasticSearch-Kopf"><span class="nav-number">9.2.</span> <span class="nav-text">ElasticSearch-Kopf</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Elasticsearch-head"><span class="nav-number">9.3.</span> <span class="nav-text">Elasticsearch-head</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ElasticSearch-Paramedic"><span class="nav-number">9.4.</span> <span class="nav-text">ElasticSearch-Paramedic</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ElasticSearch-Whatson"><span class="nav-number">9.5.</span> <span class="nav-text">ElasticSearch-Whatson</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#安装问题"><span class="nav-number">10.</span> <span class="nav-text">安装问题</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#服务启动问题-Failed-to-created-node-environment"><span class="nav-number">10.1.</span> <span class="nav-text">服务启动问题-Failed to created node environment</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#配置问题-discovery-zen-ping-unicast-hosts"><span class="nav-number">10.2.</span> <span class="nav-text">配置问题-discovery.zen.ping.unicast.hosts</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ElasticHQ安装问题"><span class="nav-number">10.3.</span> <span class="nav-text">ElasticHQ安装问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#discovery-zen-ping-unicast-hosts中的hostname-ping不通"><span class="nav-number">10.4.</span> <span class="nav-text">discovery.zen.ping.unicast.hosts中的hostname ping不通</span></a></li></ol></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator"></div>
        </section>
      

    </div>
  </aside>


    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright" >
  
  &copy; &nbsp; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="icon-next-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">geosmart</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"geosmart"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     
     
  	  <script type="text/javascript">
  		var duoshuo_user_ID = geosmart
      var duoshuo_admin_nickname="geosmart"
  	  </script>
     
  	<script src="/js/ua-parser.min.js"></script>
  	<script src="/js/hook-duoshuo.js"></script>
  

    
  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.1"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.1"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.1" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.1"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  
<script type="text/javascript" src="/js/bootstrap.scrollspy.js?v=0.4.5.1" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 0.4 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    var $tocContent = $('.post-toc-content');
    if (isDesktop() && CONFIG.sidebar === 'post') {
      if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
        displaySidebar();
      }
    }
  });
</script>



  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }
    });
  </script>

  

  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>
</body>
</html>
